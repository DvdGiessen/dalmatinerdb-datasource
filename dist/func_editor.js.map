{"version":3,"sources":["../src/func_editor.js"],"names":[],"mappings":"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","file":"func_editor.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport angular from 'angular';\n\nconst KEY_ESC = 27;\nconst KEY_ENTER = 13;\n\nangular\n  .module('grafana.directives')\n  .directive('dalmatinerFuncEditor', function($compile, templateSrv) {\n\n    var tmplLabel = '<a ng-click=\"\" title=\"Toggle function options\">{{func.name}}</a>';\n\n    var tmplArg = '<input type=\"text\" style=\"display: none; height: 1em;\" ' +\n      'class=\"input-mini tight-form-func-param\"></input>';\n\n    var tmplTools =\n      '<div class=\"tight-form-func-controls\">' +\n        '<span class=\"pointer fa fa-arrow-left\" ' +\n          'title=\"Swap this function with previous function\"></span>' +\n        '<span class=\"pointer fa fa-remove\" title=\"Remove this function\" ' +\n          'style=\"margin-right: 10px; font-size: 15px;\"></span>' +\n        '<span class=\"pointer fa fa-arrow-right\" ' +\n          'title=\"Swap this function with next function\"></span>' +\n      '</div>';\n\n    return {\n      restrict: 'A',\n      link: function postLink($scope, el) {\n\n        var $tmplLabel = $(tmplLabel);\n        var $tmplTools = $(tmplTools);\n\n        var ctrl = $scope.ctrl;\n        var func = $scope.func;\n\n        function addElementsAndCompile() {\n\n          $tmplTools.appendTo(el);\n          $tmplLabel.appendTo(el);\n\n          $('<span>(</span>').appendTo(el);\n\n          _.each(func.args, (arg, argIndex) => {\n\n            var argValue = templateSrv.highlightVariablesAsHtml(arg);\n            var $argField = $(tmplArg);\n\n            var $argLabel = $(\n              '<a ng-click=\"\" class=\"graphite-func-param-link\" ' +\n              `title=\"Edit function argument\">${argValue}</a>`\n            );\n\n            if (argIndex > 0) {\n              $('<span>, </span>').appendTo(el);\n            }\n\n            $argLabel.appendTo(el);\n            $argField.appendTo(el);\n\n            $argField.blur(_.partial(onArgEditDone, $argLabel, $argField, argIndex));\n            $argField.keyup(_.partial(onArgKeyPress, $argLabel, $argField, argIndex));\n            $argLabel.click(_.partial(onArgLabelClick, $argLabel, $argField, argIndex));\n          });\n\n          $('<span>)</span>').appendTo(el);\n\n          $compile(el.contents())($scope);\n        }\n\n        function onArgLabelClick($label, $field, argIndex) {\n          $field.val(func.args[argIndex]);\n          $field.css('width', ($label.width() + 2 * $label.height()) + 'px');\n          $label.hide();\n          $field.show();\n          $field.focus();\n          $field.select();\n        }\n\n        function onArgEditDone($label, $field, argIndex) {\n\n          var newValue = $field.val();\n\n          if (newValue && newValue !== func.args[argIndex]) {\n            $label.html(templateSrv.highlightVariablesAsHtml(newValue));\n            $scope.$apply(() => ctrl.updateFunctionArg($scope.$index, argIndex, newValue));\n          }\n\n          $field.hide();\n          $label.show();\n        }\n\n        function onArgKeyPress($label, $field, argIndex, event) {\n          switch (event.which) {\n            case KEY_ESC:\n              $field.val(func.args[argIndex]);\n              $field.hide();\n              $label.show();\n              break;\n            case KEY_ENTER:\n              onArgEditDone($label, $field, argIndex);\n              break;\n          }\n        }\n\n        function registerLabelClick() {\n          $tmplLabel.click(toggleTools);\n        }\n\n        function registerToolsClick() {\n          $tmplTools.click((event) => {\n            var $target = $(event.target);\n            switch (true) {\n              case $target.hasClass('fa-remove'):\n                $scope.$apply(() => ctrl.removeFunction($scope.$index));\n                break;\n              case $target.hasClass('fa-arrow-left'):\n                $scope.$apply(() => ctrl.moveFunction($scope.$index, $scope.$index - 1));\n                break;\n              case $target.hasClass('fa-arrow-right'):\n                $scope.$apply(() => ctrl.moveFunction($scope.$index, $scope.$index + 1));\n                break;\n            }\n          });\n        }\n\n        function toggleTools() {\n\n          const FLAG = 'is-open';\n          var toolBar = el.closest('.tight-form');\n\n          if (el.hasClass(FLAG)) {\n            el.removeClass(FLAG);\n            $tmplTools.hide();\n          } else {\n            el.addClass(FLAG);\n            $tmplTools.show();\n          }\n        }\n\n        function relink() {\n          el.children().remove();\n          addElementsAndCompile();\n          registerLabelClick();\n          registerToolsClick();\n        }\n\n        relink();\n      }\n    };\n  });\n"]}